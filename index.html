<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de RPG - Fichas Personalizadas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #1a1a2e;
            color: #e6e6e6;
            min-height: 100vh;
            padding: 20px;
            background-image: radial-gradient(#16213e 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Estilo para a se√ß√£o de dados */
        .dice-section {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 320px;
            background-color: #0f3460;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border: 2px solid #3a506b;
            z-index: 100;
        }
        
        .dice-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #3a506b;
            padding-bottom: 10px;
        }
        
        .dice-header h2 {
            color: #6efaf2;
            font-size: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .total-display {
            background-color: #16213e;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
            border: 2px solid #3a506b;
            min-height: 110px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .total-label {
            font-size: 1rem;
            color: #a9b7c6;
            margin-bottom: 5px;
        }
        
        .total-value {
            font-size: 3rem;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 0 0 10px #00d9ff;
            transition: all 0.3s ease;
        }
        
        .dice-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .dice-btn {
            background-color: #16213e;
            border: 2px solid #3a506b;
            color: #e6e6e6;
            border-radius: 8px;
            padding: 12px 5px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            position: relative;
            overflow: hidden;
        }
        
        .dice-btn:hover {
            background-color: #1f4068;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
        }
        
        .dice-btn:active {
            transform: translateY(1px);
        }
        
        .dice-icon {
            font-size: 1.8rem;
            transition: all 0.3s ease;
        }
        
        .dice-btn:hover .dice-icon {
            transform: scale(1.2) rotate(15deg);
        }
        
        .dice-btn.d4 { color: #ff9a76; }
        .dice-btn.d6 { color: #76ff9a; }
        .dice-btn.d8 { color: #769aff; }
        .dice-btn.d10 { color: #ff76d9; }
        .dice-btn.d12 { color: #ffde76; }
        .dice-btn.d20 { color: #76fff2; }
        
        .roll-btn {
            width: 100%;
            background: linear-gradient(135deg, #1a5fb4 0%, #0f3460 100%);
            border: none;
            color: white;
            border-radius: 10px;
            padding: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .roll-btn:hover {
            background: linear-gradient(135deg, #2a6fc9 0%, #1a4275 100%);
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0, 0, 0, 0.4);
        }
        
        .roll-btn:active {
            transform: translateY(1px);
        }
        
        .roll-btn.rolling {
            animation: rollPulse 0.5s infinite alternate;
        }
        
        .roll-btn.rolling .roll-icon {
            animation: spin 1s linear infinite;
        }
        
        @keyframes rollPulse {
            0% { 
                background: linear-gradient(135deg, #1a5fb4 0%, #0f3460 100%);
                box-shadow: 0 0 10px rgba(26, 95, 180, 0.5);
            }
            100% { 
                background: linear-gradient(135deg, #2a6fc9 0%, #1a4275 100%);
                box-shadow: 0 0 20px rgba(110, 250, 242, 0.7);
            }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .roll-icon {
            font-size: 1.3rem;
            transition: all 0.3s ease;
        }
        
        .roll-history {
            margin-top: 20px;
            max-height: 150px;
            overflow-y: auto;
            padding: 10px;
            background-color: rgba(15, 52, 96, 0.5);
            border-radius: 8px;
        }
        
        .history-title {
            font-size: 0.9rem;
            color: #a9b7c6;
            margin-bottom: 5px;
        }
        
        .history-item {
            font-size: 0.9rem;
            padding: 3px 0;
            border-bottom: 1px solid rgba(58, 80, 107, 0.5);
        }
        
        /* Anima√ß√£o para dados */
        .dice-rolling {
            animation: diceRoll 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes diceRoll {
            0% { 
                transform: translateY(-30px) rotate(0deg) scale(0.8); 
                opacity: 0.3;
                text-shadow: 0 0 5px currentColor;
            }
            20% {
                transform: translateY(20px) rotate(180deg) scale(1.1);
                opacity: 0.7;
                text-shadow: 0 0 15px currentColor;
            }
            40% {
                transform: translateY(-15px) rotate(360deg) scale(0.9);
                opacity: 0.5;
            }
            60% {
                transform: translateY(10px) rotate(540deg) scale(1.05);
                opacity: 0.8;
            }
            80% {
                transform: translateY(-5px) rotate(720deg) scale(0.95);
                opacity: 0.9;
                text-shadow: 0 0 10px currentColor;
            }
            100% { 
                transform: translateY(0) rotate(900deg) scale(1); 
                opacity: 1;
                text-shadow: 0 0 5px currentColor;
            }
        }
        
        /* Estilo para a se√ß√£o de personagens */
        .characters-section {
            margin-right: 360px;
            padding: 20px;
        }
        
        .characters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .characters-header h1 {
            color: #6efaf2;
            font-size: 2.2rem;
            text-shadow: 0 0 5px rgba(110, 250, 242, 0.5);
        }
        
        .characters-controls {
            display: flex;
            gap: 15px;
        }
        
        .add-character-btn {
            background-color: #1a5fb4;
            border: none;
            color: white;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .add-character-btn:hover {
            background-color: #2a6fc9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 95, 180, 0.4);
        }
        
        .layout-controls {
            display: flex;
            gap: 10px;
        }
        
        .layout-btn {
            background-color: #0f3460;
            border: 1px solid #3a506b;
            color: #e6e6e6;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .layout-btn:hover, .layout-btn.active {
            background-color: #1a5fb4;
            transform: translateY(-2px);
        }
        
        .characters-container {
            display: grid;
            gap: 25px;
            transition: all 0.3s ease;
        }
        
        /* Layouts diferentes */
        .layout-1 {
            grid-template-columns: 1fr;
        }
        
        .layout-2 {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .layout-4 {
            grid-template-columns: repeat(2, 1fr);
        }
        
        @media (min-width: 1200px) {
            .layout-4 {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        /* Estilo para cada personagem */
        .character-card {
            background-color: #0f3460;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            border: 2px solid #3a506b;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .character-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.5);
        }
        
        .character-edit-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #a9b7c6;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.2s ease;
            z-index: 2;
        }
        
        .character-edit-btn:hover {
            color: #6efaf2;
            background-color: rgba(110, 250, 242, 0.1);
            transform: scale(1.1);
        }
        
        .character-delete-btn {
            position: absolute;
            top: 15px;
            right: 45px;
            background: none;
            border: none;
            color: #a9b7c6;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.2s ease;
            z-index: 2;
        }
        
        .character-delete-btn:hover {
            color: #ff7676;
            background-color: rgba(255, 118, 118, 0.1);
            transform: scale(1.1);
        }
        
        .character-image-container {
            width: 100%;
            height: 180px;
            background-color: #16213e;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #3a506b;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .character-image-container:hover {
            border-color: #6efaf2;
            transform: scale(1.02);
        }
        
        .character-image-container.drag-over {
            border-color: #76ff9a;
            background-color: rgba(118, 255, 154, 0.1);
        }
        
        .character-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: none;
            transition: all 0.3s ease;
        }
        
        .character-image.active {
            display: block;
        }
        
        .character-image-container:hover .character-image {
            transform: scale(1.05);
        }
        
        .image-placeholder {
            color: #3a506b;
            font-size: 3rem;
            text-align: center;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .character-image-container:hover .image-placeholder {
            color: #6efaf2;
            transform: scale(1.1);
        }
        
        .image-placeholder-text {
            font-size: 0.9rem;
            color: #3a506b;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        .character-image-container:hover .image-placeholder-text {
            color: #a9b7c6;
        }
        
        .character-name {
            text-align: center;
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #ffffff;
            padding-bottom: 10px;
            border-bottom: 2px solid #3a506b;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .character-info {
            margin-bottom: 25px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(58, 80, 107, 0.5);
        }
        
        .info-label {
            color: #a9b7c6;
            font-size: 0.95rem;
        }
        
        .info-value {
            font-weight: 600;
            color: #ffffff;
        }
        
        .health-section {
            margin-bottom: 25px;
            background-color: rgba(22, 33, 62, 0.5);
            border-radius: 10px;
            padding: 15px;
        }
        
        .health-label {
            font-size: 0.9rem;
            color: #a9b7c6;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        
        .health-display {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .health-value {
            font-size: 2.8rem;
            font-weight: bold;
            color: #ff9a76;
            transition: all 0.3s ease;
        }
        
        .health-value.changing {
            animation: healthChange 0.5s ease;
        }
        
        @keyframes healthChange {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        .health-max {
            font-size: 1.4rem;
            color: #a9b7c6;
        }
        
        .health-bar {
            height: 12px;
            background-color: #16213e;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .health-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff9a76, #ff7676);
            border-radius: 6px;
            transition: width 0.5s ease;
        }
        
        .health-controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .health-btn {
            background-color: #16213e;
            border: 2px solid #3a506b;
            color: #e6e6e6;
            border-radius: 8px;
            padding: 12px 5px;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .health-btn:hover {
            background-color: #1f4068;
            transform: translateY(-2px);
        }
        
        .health-btn:active {
            transform: translateY(1px);
        }
        
        .health-btn.plus:hover {
            color: #76ff9a;
            border-color: #76ff9a;
            box-shadow: 0 0 10px rgba(118, 255, 154, 0.3);
        }
        
        .health-btn.minus:hover {
            color: #ff7676;
            border-color: #ff7676;
            box-shadow: 0 0 10px rgba(255, 118, 118, 0.3);
        }
        
        .health-btn.big {
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        /* Calculadora de vida */
        .calculator-section {
            background-color: #16213e;
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
            border: 1px solid #3a506b;
        }
        
        .calculator-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .calculator-title {
            font-size: 0.9rem;
            color: #a9b7c6;
        }
        
        .calculator-mode {
            font-size: 0.8rem;
            color: #3a506b;
            padding: 3px 8px;
            background-color: #0f1a2e;
            border-radius: 4px;
        }
        
        .calculator-display {
            background-color: #0f1a2e;
            border-radius: 5px;
            padding: 12px;
            text-align: center;
            margin-bottom: 10px;
            font-size: 1.5rem;
            min-height: 50px;
            border: 1px solid #3a506b;
            color: #ffffff;
            font-weight: bold;
            word-break: break-all;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .calculator-display:hover {
            border-color: #6efaf2;
            box-shadow: 0 0 10px rgba(110, 250, 242, 0.2);
        }
        
        .calculator-display.active {
            border-color: #6efaf2;
            background-color: rgba(110, 250, 242, 0.05);
            box-shadow: 0 0 15px rgba(110, 250, 242, 0.3);
        }
        
        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .calc-btn {
            background-color: #0f3460;
            border: 1px solid #3a506b;
            color: #e6e6e6;
            border-radius: 5px;
            padding: 12px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .calc-btn:hover {
            background-color: #1a5fb4;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }
        
        .calc-btn:active {
            transform: translateY(1px);
        }
        
        .calc-btn.clear {
            background-color: #b41a1a;
        }
        
        .calc-btn.clear:hover {
            background-color: #c92a2a;
            box-shadow: 0 0 10px rgba(201, 42, 42, 0.4);
        }
        
        .calc-btn.apply {
            background-color: #1a5fb4;
            grid-column: span 2;
        }
        
        .calc-btn.apply:hover {
            background-color: #2a6fc9;
            box-shadow: 0 0 15px rgba(42, 111, 201, 0.4);
        }
        
        /* Modal de edi√ß√£o */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal {
            background-color: #0f3460;
            border-radius: 15px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid #3a506b;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.7);
            animation: modalAppear 0.3s ease-out;
        }
        
        @keyframes modalAppear {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #3a506b;
            padding-bottom: 15px;
        }
        
        .modal-header h2 {
            color: #6efaf2;
            font-size: 1.8rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: #a9b7c6;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.2s ease;
        }
        
        .close-modal:hover {
            color: #ff7676;
            transform: scale(1.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #a9b7c6;
            font-size: 0.95rem;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            background-color: #16213e;
            border: 2px solid #3a506b;
            border-radius: 8px;
            color: #ffffff;
            font-size: 1rem;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #6efaf2;
            box-shadow: 0 0 10px rgba(110, 250, 242, 0.3);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .file-upload {
            position: relative;
            width: 100%;
            height: 120px;
            border: 2px dashed #3a506b;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #16213e;
            margin-top: 10px;
        }
        
        .file-upload:hover, .file-upload.drag-over {
            border-color: #6efaf2;
            background-color: rgba(110, 250, 242, 0.1);
            box-shadow: 0 0 15px rgba(110, 250, 242, 0.2);
        }
        
        .file-upload-icon {
            font-size: 2.5rem;
            color: #3a506b;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .file-upload:hover .file-upload-icon {
            color: #6efaf2;
            transform: scale(1.1);
        }
        
        .file-upload-text {
            color: #a9b7c6;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .file-upload input {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .modal-btn:active {
            transform: translateY(1px);
        }
        
        .modal-btn.save {
            background-color: #1a5fb4;
            color: white;
        }
        
        .modal-btn.save:hover {
            background-color: #2a6fc9;
            box-shadow: 0 5px 15px rgba(26, 95, 180, 0.4);
        }
        
        .modal-btn.cancel {
            background-color: #16213e;
            color: #e6e6e6;
            border: 2px solid #3a506b;
        }
        
        .modal-btn.cancel:hover {
            background-color: #1f4068;
        }
        
        /* Modal para visualizar imagem expandida */
        .image-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .image-modal {
            background-color: #0f3460;
            border-radius: 15px;
            padding: 20px;
            max-width: 90vw;
            max-height: 90vh;
            border: 2px solid #3a506b;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.8);
            animation: imageModalAppear 0.3s ease-out;
            display: flex;
            flex-direction: column;
        }
        
        @keyframes imageModalAppear {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .image-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3a506b;
        }
        
        .image-modal-header h3 {
            color: #6efaf2;
            font-size: 1.5rem;
        }
        
        .close-image-modal {
            background: none;
            border: none;
            color: #a9b7c6;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.2s ease;
        }
        
        .close-image-modal:hover {
            color: #ff7676;
            transform: scale(1.1);
        }
        
        .image-modal-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .image-modal-img {
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
            border-radius: 10px;
        }
        
        /* Rodap√© */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #3a506b;
            color: #a9b7c6;
            font-size: 0.9rem;
        }
        
        .keyboard-shortcuts {
            margin-top: 10px;
            font-size: 0.8rem;
            color: #3a506b;
        }
        
        /* Responsividade */
        @media (max-width: 1100px) {
            .dice-section {
                position: static;
                width: 100%;
                margin-bottom: 30px;
            }
            
            .characters-section {
                margin-right: 0;
            }
            
            .layout-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .layout-2, .layout-4 {
                grid-template-columns: 1fr;
            }
            
            .characters-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .characters-controls {
                width: 100%;
                flex-direction: column;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .health-controls {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .calculator-buttons {
                grid-template-columns: 1fr;
            }
            
            .dice-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Se√ß√£o de dados -->
        <div class="dice-section">
            <div class="dice-header">
                <h2>Jogar os dados</h2>
            </div>
            
            <div class="total-display">
                <div class="total-label">Total</div>
                <div class="total-value" id="totalValue">0</div>
            </div>
            
            <div class="dice-buttons">
                <button class="dice-btn d4" data-sides="4">
                    <i class="dice-icon fas fa-dice-d4"></i>
                    <span>d4</span>
                </button>
                <button class="dice-btn d6" data-sides="6">
                    <i class="dice-icon fas fa-dice-d6"></i>
                    <span>d6</span>
                </button>
                <button class="dice-btn d8" data-sides="8">
                    <i class="dice-icon fas fa-dice-d8"></i>
                    <span>d8</span>
                </button>
                <button class="dice-btn d10" data-sides="10">
                    <i class="dice-icon fas fa-dice-d10"></i>
                    <span>d10</span>
                </button>
                <button class="dice-btn d12" data-sides="12">
                    <i class="dice-icon fas fa-dice-d12"></i>
                    <span>d12</span>
                </button>
                <button class="dice-btn d20" data-sides="20">
                    <i class="dice-icon fas fa-dice-d20"></i>
                    <span>d20</span>
                </button>
                <button class="dice-btn" id="clearBtn">
                    <i class="dice-icon fas fa-trash"></i>
                    <span>C</span>
                </button>
                <button class="dice-btn" id="undoBtn">
                    <i class="dice-icon fas fa-undo"></i>
                    <span>‚Ü∂</span>
                </button>
            </div>
            
            <button class="roll-btn" id="rollBtn">
                <i class="roll-icon fas fa-dice"></i>
                <span>Rolar</span>
            </button>
            
            <div class="roll-history">
                <div class="history-title">Hist√≥rico de Rolagens:</div>
                <div id="historyList"></div>
            </div>
        </div>
        
        <!-- Se√ß√£o de personagens -->
        <div class="characters-section">
            <div class="characters-header">
                <h1>Gerenciador de Fichas - RPG</h1>
                <div class="characters-controls">
                    <button class="add-character-btn" id="addCharacterBtn">
                        <i class="fas fa-plus"></i>
                        <span>Novo Personagem</span>
                    </button>
                    <div class="layout-controls">
                        <button class="layout-btn active" data-layout="1">
                            <i class="fas fa-expand"></i>
                            <span>1 Grande</span>
                        </button>
                        <button class="layout-btn" data-layout="2">
                            <i class="fas fa-columns"></i>
                            <span>2 Lado a Lado</span>
                        </button>
                        <button class="layout-btn" data-layout="4">
                            <i class="fas fa-th-large"></i>
                            <span>4 em Grade</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="characters-container layout-1" id="charactersContainer">
                <!-- Mensagem inicial -->
                <div style="text-align: center; padding: 60px; grid-column: 1 / -1;">
                    <h3 style="color: #6efaf2; margin-bottom: 20px;">Bem-vindo ao Gerenciador de RPG!</h3>
                    <p style="color: #a9b7c6; margin-bottom: 30px; max-width: 600px; margin-left: auto; margin-right: auto;">
                        Comece criando seu primeiro personagem. Voc√™ pode adicionar imagens arrastando arquivos PNG/JPG da sua pasta de documentos ou clicando para selecionar.
                        <strong>Clique na imagem para visualiz√°-la em tamanho maior!</strong>
                    </p>
                    <button class="add-character-btn" id="startAddCharacterBtn" style="margin: 0 auto; font-size: 1.1rem; padding: 12px 30px;">
                        <i class="fas fa-plus"></i>
                        <span>Criar Primeiro Personagem</span>
                    </button>
                </div>
            </div>
            
            <div class="footer">
                <p>Gerenciador de RPG - Use a calculadora para ajustes precisos de vida (digite n√∫meros no teclado)</p>
                <div class="keyboard-shortcuts">
                    Atalhos: Teclas 1-6 para dados | Enter para rolar | ESC para limpar | Backspace para desfazer
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar personagem -->
    <div class="modal-overlay" id="modalOverlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modalTitle">Novo Personagem</h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <form id="characterForm">
                <div class="form-group">
                    <label for="charName">Nome do Personagem *</label>
                    <input type="text" id="charName" required placeholder="Ex: Aragorn, Merlin">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="charHealth">Vida Atual *</label>
                        <input type="number" id="charHealth" min="0" required value="10">
                    </div>
                    <div class="form-group">
                        <label for="charMaxHealth">Vida M√°xima *</label>
                        <input type="number" id="charMaxHealth" min="1" required value="20">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="charClass">Classe</label>
                    <input type="text" id="charClass" placeholder="Ex: Guerreiro, Mago, Cl√©rigo">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="charLevel">N√≠vel</label>
                        <input type="number" id="charLevel" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label for="charRace">Ra√ßa</label>
                        <input type="text" id="charRace" placeholder="Ex: Humano, Elfo, An√£o">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Imagem do Personagem</label>
                    <div class="file-upload" id="fileUpload">
                        <div class="file-upload-icon">üì∑</div>
                        <div class="file-upload-text">
                            <div>Arraste e solte uma imagem aqui</div>
                            <div style="font-size: 0.8rem; margin-top: 5px;">ou clique para selecionar</div>
                            <div style="font-size: 0.7rem; margin-top: 5px; color: #3a506b;">PNG, JPG (m√°x. 5MB)</div>
                        </div>
                        <input type="file" id="imageInput" accept=".png,.jpg,.jpeg,.webp">
                    </div>
                    <div id="fileName" style="margin-top: 10px; color: #a9b7c6; font-size: 0.9rem; display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label for="charNotes">Anota√ß√µes</label>
                    <input type="text" id="charNotes" placeholder="Equipamentos, habilidades, status...">
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="modal-btn cancel" id="cancelBtn">Cancelar</button>
                    <button type="submit" class="modal-btn save">Criar Personagem</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para visualizar imagem expandida -->
    <div class="image-modal-overlay" id="imageModalOverlay" style="display: none;">
        <div class="image-modal">
            <div class="image-modal-header">
                <h3 id="imageModalTitle">Imagem do Personagem</h3>
                <button class="close-image-modal" id="closeImageModal">&times;</button>
            </div>
            <div class="image-modal-content">
                <img id="expandedImage" class="image-modal-img" src="" alt="Imagem expandida">
            </div>
        </div>
    </div>

    <script>
        // Sistema de armazenamento local
        const STORAGE_KEY = 'rpgCharacters';
        
        // Come√ßar com lista vazia
        let characters = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        let nextCharacterId = characters.length > 0 ? Math.max(...characters.map(c => c.id)) + 1 : 1;
        
        // Sistema de dados
        let diceHistory = [];
        let currentRolls = [];
        let total = 0;
        let isRolling = false;
        
        // Sistema de calculadora
        let activeCalculator = null; // ID do personagem com calculadora ativa
        
        // Vari√°veis para edi√ß√£o de personagem
        let editingCharacterId = null;
        let currentImageFile = null;
        
        // Elementos DOM
        const totalValueEl = document.getElementById('totalValue');
        const rollBtn = document.getElementById('rollBtn');
        const clearBtn = document.getElementById('clearBtn');
        const undoBtn = document.getElementById('undoBtn');
        const historyListEl = document.getElementById('historyList');
        const charactersContainer = document.getElementById('charactersContainer');
        const layoutBtns = document.querySelectorAll('.layout-btn');
        const addCharacterBtn = document.getElementById('addCharacterBtn');
        const startAddCharacterBtn = document.getElementById('startAddCharacterBtn');
        const modalOverlay = document.getElementById('modalOverlay');
        const closeModal = document.getElementById('closeModal');
        const cancelBtn = document.getElementById('cancelBtn');
        const characterForm = document.getElementById('characterForm');
        const modalTitle = document.getElementById('modalTitle');
        const fileUpload = document.getElementById('fileUpload');
        const imageInput = document.getElementById('imageInput');
        const fileName = document.getElementById('fileName');
        
        // Elementos do modal de imagem
        const imageModalOverlay = document.getElementById('imageModalOverlay');
        const closeImageModal = document.getElementById('closeImageModal');
        const expandedImage = document.getElementById('expandedImage');
        const imageModalTitle = document.getElementById('imageModalTitle');
        
        // Elementos do formul√°rio
        const charNameInput = document.getElementById('charName');
        const charHealthInput = document.getElementById('charHealth');
        const charMaxHealthInput = document.getElementById('charMaxHealth');
        const charClassInput = document.getElementById('charClass');
        const charLevelInput = document.getElementById('charLevel');
        const charRaceInput = document.getElementById('charRace');
        const charNotesInput = document.getElementById('charNotes');
        
        // Inicializar dados
        document.querySelectorAll('.dice-btn[data-sides]').forEach(btn => {
            btn.addEventListener('click', () => {
                const sides = parseInt(btn.getAttribute('data-sides'));
                addDice(sides);
                
                // Anima√ß√£o no bot√£o clicado
                btn.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    btn.style.transform = '';
                }, 150);
            });
        });
        
        // Sistema de arrastar e soltar para imagens
        function setupDragAndDrop() {
            const dragOverHandler = (e) => {
                e.preventDefault();
                e.stopPropagation();
                fileUpload.classList.add('drag-over');
            };
            
            const dragLeaveHandler = (e) => {
                e.preventDefault();
                e.stopPropagation();
                fileUpload.classList.remove('drag-over');
            };
            
            const dropHandler = (e) => {
                e.preventDefault();
                e.stopPropagation();
                fileUpload.classList.remove('drag-over');
                
                if (e.dataTransfer.files.length) {
                    handleImageFile(e.dataTransfer.files[0]);
                }
            };
            
            // Eventos para o modal
            fileUpload.addEventListener('dragover', dragOverHandler);
            fileUpload.addEventListener('dragleave', dragLeaveHandler);
            fileUpload.addEventListener('drop', dropHandler);
            
            // Eventos para os cards de personagem
            document.addEventListener('dragover', (e) => {
                e.preventDefault();
            });
            
            document.addEventListener('drop', (e) => {
                e.preventDefault();
                const characterCard = e.target.closest('.character-card');
                if (characterCard && e.dataTransfer.files.length) {
                    const characterId = parseInt(characterCard.dataset.id);
                    const file = e.dataTransfer.files[0];
                    
                    if (file.type.startsWith('image/')) {
                        updateCharacterImage(characterId, file);
                    }
                }
            });
        }
        
        // Manipular arquivo de imagem
        function handleImageFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('Por favor, selecione apenas arquivos de imagem (PNG, JPG, etc.)');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                alert('A imagem √© muito grande. Por favor, selecione uma imagem menor que 5MB.');
                return;
            }
            
            currentImageFile = file;
            fileName.textContent = `Arquivo: ${file.name}`;
            fileName.style.display = 'block';
        }
        
        // Atualizar imagem de um personagem existente
        function updateCharacterImage(characterId, file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const characterIndex = characters.findIndex(c => c.id === characterId);
                if (characterIndex !== -1) {
                    characters[characterIndex].image = e.target.result;
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(characters));
                    
                    // Atualizar visualiza√ß√£o
                    const currentLayout = document.querySelector('.layout-btn.active').getAttribute('data-layout');
                    renderCharacters(parseInt(currentLayout));
                }
            };
            reader.readAsDataURL(file);
        }
        
        // Mostrar imagem expandida
        function showExpandedImage(imageSrc, characterName) {
            expandedImage.src = imageSrc;
            imageModalTitle.textContent = `Imagem de ${characterName}`;
            imageModalOverlay.style.display = 'flex';
        }
        
        // Fechar modal de imagem
        function closeImageModalFunc() {
            imageModalOverlay.style.display = 'none';
        }
        
        // Adicionar um dado √† rolagem atual
        function addDice(sides) {
            currentRolls.push({sides, value: null});
            updateDiceDisplay();
        }
        
        // Atualizar exibi√ß√£o dos dados
        function updateDiceDisplay() {
            let displayText = "";
            
            currentRolls.forEach((dice, index) => {
                if (dice.value !== null) {
                    displayText += `<span style="color: ${getDiceColor(dice.sides)}">${dice.value}</span>`;
                } else {
                    displayText += `d${dice.sides}`;
                }
                
                if (index < currentRolls.length - 1) {
                    displayText += " + ";
                }
            });
            
            if (currentRolls.length === 0) {
                totalValueEl.textContent = "0";
            } else if (currentRolls.every(dice => dice.value !== null)) {
                totalValueEl.innerHTML = `${displayText} = <span style="color: #6efaf2">${total}</span>`;
            } else {
                totalValueEl.innerHTML = displayText || "0";
            }
        }
        
        // Rolar todos os dados com anima√ß√£o
        function rollAllDice() {
            if (currentRolls.length === 0) {
                alert("Adicione pelo menos um dado para rolar!");
                return;
            }
            
            if (isRolling) return;
            isRolling = true;
            
            // Adicionar classe de anima√ß√£o ao bot√£o
            rollBtn.classList.add('rolling');
            rollBtn.disabled = true;
            
            // Anima√ß√£o nos dados
            totalValueEl.classList.add('dice-rolling');
            
            // Desabilitar bot√µes durante a rolagem
            document.querySelectorAll('.dice-btn').forEach(btn => {
                btn.disabled = true;
            });
            
            // Efeito visual de dados rolando
            let rollCount = 0;
            const rollInterval = setInterval(() => {
                rollCount++;
                
                // Mostrar n√∫meros aleat√≥rios durante a anima√ß√£o
                let tempDisplay = "";
                currentRolls.forEach((dice, index) => {
                    const randomVal = Math.floor(Math.random() * dice.sides) + 1;
                    tempDisplay += `<span style="color: ${getDiceColor(dice.sides)}">${randomVal}</span>`;
                    if (index < currentRolls.length - 1) tempDisplay += " + ";
                });
                
                totalValueEl.innerHTML = tempDisplay;
                
                if (rollCount > 5) {
                    clearInterval(rollInterval);
                    
                    // Calcular resultados finais
                    total = 0;
                    currentRolls.forEach(dice => {
                        dice.value = Math.floor(Math.random() * dice.sides) + 1;
                        total += dice.value;
                    });
                    
                    // Adicionar ao hist√≥rico
                    const historyEntry = {
                        rolls: [...currentRolls],
                        total: total,
                        timestamp: new Date().toLocaleTimeString()
                    };
                    
                    diceHistory.unshift(historyEntry);
                    updateDiceDisplay();
                    updateHistory();
                    
                    // Finalizar anima√ß√£o
                    setTimeout(() => {
                        totalValueEl.classList.remove('dice-rolling');
                        rollBtn.classList.remove('rolling');
                        rollBtn.disabled = false;
                        
                        // Reabilitar bot√µes
                        document.querySelectorAll('.dice-btn').forEach(btn => {
                            btn.disabled = false;
                        });
                        
                        isRolling = false;
                        
                        // Efeito de confete visual
                        createConfettiEffect();
                        
                        // Limpar rolagens atuais ap√≥s 3 segundos
                        setTimeout(() => {
                            if (!isRolling) {
                                currentRolls = [];
                                updateDiceDisplay();
                            }
                        }, 3000);
                    }, 500);
                }
            }, 100);
        }
        
        // Criar efeito de confete visual
        function createConfettiEffect() {
            const colors = ['#ff9a76', '#76ff9a', '#769aff', '#ff76d9', '#ffde76', '#76fff2'];
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'fixed';
                    confetti.style.width = '10px';
                    confetti.style.height = '10px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = '50%';
                    confetti.style.left = `${Math.random() * 100}vw`;
                    confetti.style.top = '-20px';
                    confetti.style.zIndex = '9999';
                    confetti.style.pointerEvents = 'none';
                    
                    document.body.appendChild(confetti);
                    
                    // Anima√ß√£o do confete
                    const animation = confetti.animate([
                        { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                        { transform: `translateY(${window.innerHeight + 20}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
                    ], {
                        duration: 1000 + Math.random() * 1000,
                        easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
                    });
                    
                    animation.onfinish = () => {
                        confetti.remove();
                    };
                }, i * 50);
            }
        }
        
        // Atualizar hist√≥rico
        function updateHistory() {
            historyListEl.innerHTML = "";
            
            diceHistory.slice(0, 5).forEach(entry => {
                let rollText = "";
                entry.rolls.forEach((dice, index) => {
                    rollText += `<span style="color: ${getDiceColor(dice.sides)}">${dice.value}</span>`;
                    if (index < entry.rolls.length - 1) rollText += " + ";
                });
                
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `${rollText} = <strong>${entry.total}</strong> <span style="color: #a9b7c6; font-size: 0.8rem;">${entry.timestamp}</span>`;
                historyListEl.appendChild(historyItem);
            });
        }
        
        // Obter cor do dado
        function getDiceColor(sides) {
            const colors = {
                4: '#ff9a76',
                6: '#76ff9a',
                8: '#769aff',
                10: '#ff76d9',
                12: '#ffde76',
                20: '#76fff2'
            };
            return colors[sides] || '#ffffff';
        }
        
        // Limpar dados
        clearBtn.addEventListener('click', () => {
            currentRolls = [];
            total = 0;
            updateDiceDisplay();
            
            // Anima√ß√£o no bot√£o
            clearBtn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                clearBtn.style.transform = '';
            }, 150);
        });
        
        // Desfazer √∫ltimo dado adicionado
        undoBtn.addEventListener('click', () => {
            if (currentRolls.length > 0) {
                currentRolls.pop();
                updateDiceDisplay();
                
                // Anima√ß√£o no bot√£o
                undoBtn.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    undoBtn.style.transform = '';
                }, 150);
            }
        });
        
        // Rolagem de dados
        rollBtn.addEventListener('click', rollAllDice);
        
        // Fechar modal de imagem
        closeImageModal.addEventListener('click', closeImageModalFunc);
        imageModalOverlay.addEventListener('click', (e) => {
            if (e.target === imageModalOverlay) {
                closeImageModalFunc();
            }
        });
        
        // Sistema de layout
        layoutBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Remover classe active de todos
                layoutBtns.forEach(b => b.classList.remove('active'));
                // Adicionar classe active ao bot√£o clicado
                btn.classList.add('active');
                
                // Anima√ß√£o no bot√£o
                btn.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    btn.style.transform = '';
                }, 150);
                
                // Alterar layout
                const layout = btn.getAttribute('data-layout');
                charactersContainer.className = `characters-container layout-${layout}`;
                
                // Mostrar n√∫mero apropriado de personagens
                renderCharacters(parseInt(layout));
            });
        });
        
        // Abrir modal para adicionar/editar personagem
        function openCharacterModal(character = null) {
            if (character) {
                // Modo edi√ß√£o
                editingCharacterId = character.id;
                modalTitle.textContent = "Editar Personagem";
                
                // Preencher formul√°rio
                charNameInput.value = character.name;
                charHealthInput.value = character.health;
                charMaxHealthInput.value = character.maxHealth;
                charClassInput.value = character.class || "";
                charLevelInput.value = character.level || 1;
                charRaceInput.value = character.race || "";
                charNotesInput.value = character.notes || "";
                
                // Limpar imagem atual
                currentImageFile = null;
                fileName.style.display = 'none';
            } else {
                // Modo cria√ß√£o
                editingCharacterId = null;
                modalTitle.textContent = "Novo Personagem";
                
                // Limpar formul√°rio
                charNameInput.value = "";
                charHealthInput.value = 10;
                charMaxHealthInput.value = 20;
                charClassInput.value = "";
                charLevelInput.value = 1;
                charRaceInput.value = "";
                charNotesInput.value = "";
                
                // Limpar imagem
                currentImageFile = null;
                fileName.style.display = 'none';
            }
            
            modalOverlay.style.display = "flex";
            charNameInput.focus();
        }
        
        // Fechar modal
        function closeCharacterModal() {
            modalOverlay.style.display = "none";
            editingCharacterId = null;
            currentImageFile = null;
        }
        
        // Salvar personagem
        function saveCharacter(formData) {
            // Processar imagem se houver
            if (currentImageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    formData.image = e.target.result;
                    completeSave(formData);
                };
                reader.readAsDataURL(currentImageFile);
            } else {
                // Manter imagem existente se estiver editando
                if (editingCharacterId) {
                    const existingCharacter = characters.find(c => c.id === editingCharacterId);
                    if (existingCharacter && existingCharacter.image) {
                        formData.image = existingCharacter.image;
                    }
                }
                completeSave(formData);
            }
        }
        
        function completeSave(formData) {
            if (editingCharacterId) {
                // Atualizar personagem existente
                const index = characters.findIndex(c => c.id === editingCharacterId);
                if (index !== -1) {
                    characters[index] = {
                        ...characters[index],
                        ...formData
                    };
                }
            } else {
                // Criar novo personagem
                const newCharacter = {
                    id: nextCharacterId++,
                    ...formData
                };
                characters.push(newCharacter);
            }
            
            // Salvar no localStorage
            localStorage.setItem(STORAGE_KEY, JSON.stringify(characters));
            
            // Atualizar visualiza√ß√£o
            const currentLayout = document.querySelector('.layout-btn.active').getAttribute('data-layout');
            renderCharacters(parseInt(currentLayout));
            
            closeCharacterModal();
        }
        
        // Excluir personagem
        function deleteCharacter(characterId) {
            if (confirm("Tem certeza que deseja excluir este personagem?")) {
                characters = characters.filter(c => c.id !== characterId);
                
                // Salvar no localStorage
                localStorage.setItem(STORAGE_KEY, JSON.stringify(characters));
                
                // Atualizar visualiza√ß√£o
                const currentLayout = document.querySelector('.layout-btn.active').getAttribute('data-layout');
                renderCharacters(parseInt(currentLayout));
            }
        }
        
        // Eventos do modal
        closeModal.addEventListener('click', closeCharacterModal);
        cancelBtn.addEventListener('click', closeCharacterModal);
        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) {
                closeCharacterModal();
            }
        });
        
        // Evento do formul√°rio
        characterForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const formData = {
                name: charNameInput.value.trim(),
                health: parseInt(charHealthInput.value),
                maxHealth: parseInt(charMaxHealthInput.value),
                class: charClassInput.value.trim(),
                level: parseInt(charLevelInput.value),
                race: charRaceInput.value.trim(),
                notes: charNotesInput.value.trim()
            };
            
            // Validar vida
            if (formData.health > formData.maxHealth) {
                formData.health = formData.maxHealth;
            }
            
            saveCharacter(formData);
        });
        
        // Evento para sele√ß√£o de arquivo
        imageInput.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleImageFile(e.target.files[0]);
            }
        });
        
        // Adicionar novo personagem
        addCharacterBtn.addEventListener('click', () => {
            openCharacterModal();
        });
        
        // Bot√£o inicial para adicionar personagem
        startAddCharacterBtn.addEventListener('click', () => {
            openCharacterModal();
        });
        
        // Renderizar personagens
        function renderCharacters(layout) {
            charactersContainer.innerHTML = "";
            
            if (characters.length === 0) {
                // Mostrar mensagem inicial
                charactersContainer.innerHTML = `
                    <div style="text-align: center; padding: 60px; grid-column: 1 / -1;">
                        <h3 style="color: #6efaf2; margin-bottom: 20px;">Bem-vindo ao Gerenciador de RPG!</h3>
                        <p style="color: #a9b7c6; margin-bottom: 30px; max-width: 600px; margin-left: auto; margin-right: auto;">
                            Comece criando seu primeiro personagem. Voc√™ pode adicionar imagens arrastando arquivos PNG/JPG da sua pasta de documentos ou clicando para selecionar.
                            <strong>Clique na imagem para visualiz√°-la em tamanho maior!</strong>
                        </p>
                        <button class="add-character-btn" id="startAddCharacterBtn" style="margin: 0 auto; font-size: 1.1rem; padding: 12px 30px;">
                            <i class="fas fa-plus"></i>
                            <span>Criar Primeiro Personagem</span>
                        </button>
                    </div>
                `;
                
                // Adicionar evento ao bot√£o
                const addBtn = charactersContainer.querySelector('#startAddCharacterBtn');
                if (addBtn) {
                    addBtn.addEventListener('click', () => openCharacterModal());
                }
                return;
            }
            
            // Determinar quantos personagens mostrar baseado no layout
            let charactersToShow = characters;
            if (layout === 1) {
                charactersToShow = characters.slice(0, 1);
            } else if (layout === 2) {
                charactersToShow = characters.slice(0, 2);
            } else if (layout === 4) {
                charactersToShow = characters.slice(0, 4);
            }
            
            charactersToShow.forEach(character => {
                const characterCard = createCharacterCard(character);
                charactersContainer.appendChild(characterCard);
            });
        }
        
        // Criar card de personagem
        function createCharacterCard(character) {
            const card = document.createElement('div');
            card.className = 'character-card';
            card.dataset.id = character.id;
            
            // Calcular porcentagem da barra de vida
            const healthPercent = (character.health / character.maxHealth) * 100;
            
            card.innerHTML = `
                <button class="character-edit-btn" title="Editar personagem">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="character-delete-btn" title="Excluir personagem">
                    <i class="fas fa-trash"></i>
                </button>
                
                <div class="character-image-container" title="Clique para ver imagem maior">
                    ${character.image ? 
                        `<img src="${character.image}" alt="${character.name}" class="character-image active">` : 
                        '<div class="image-placeholder">üì∑<div class="image-placeholder-text">Clique ou arraste imagem</div></div>'
                    }
                </div>
                
                <div class="character-name">${character.name}</div>
                
                <div class="character-info">
                    ${character.class ? `
                    <div class="info-row">
                        <span class="info-label">Classe</span>
                        <span class="info-value">${character.class}</span>
                    </div>` : ''}
                    
                    ${character.race ? `
                    <div class="info-row">
                        <span class="info-label">Ra√ßa</span>
                        <span class="info-value">${character.race}</span>
                    </div>` : ''}
                    
                    <div class="info-row">
                        <span class="info-label">N√≠vel</span>
                        <span class="info-value">${character.level || 1}</span>
                    </div>
                    
                    ${character.notes ? `
                    <div class="info-row">
                        <span class="info-label">Anota√ß√µes</span>
                        <span class="info-value" style="font-size: 0.9rem;">${character.notes}</span>
                    </div>` : ''}
                </div>
                
                <div class="health-section">
                    <div class="health-label">
                        <span>Pontos de Vida</span>
                        <span>${character.health} / ${character.maxHealth}</span>
                    </div>
                    
                    <div class="health-bar">
                        <div class="health-bar-fill" style="width: ${healthPercent}%"></div>
                    </div>
                    
                    <div class="health-display">
                        <div class="health-value" id="health-value-${character.id}">${character.health}</div>
                        <div class="health-max">/ ${character.maxHealth}</div>
                    </div>
                    
                    <div class="health-controls">
                        <button class="health-btn minus big" data-amount="10">-10</button>
                        <button class="health-btn minus" data-amount="5">-5</button>
                        <button class="health-btn plus" data-amount="5">+5</button>
                        <button class="health-btn plus big" data-amount="10">+10</button>
                    </div>
                    
                    <div class="calculator-section">
                        <div class="calculator-header">
                            <div class="calculator-title">Calculadora de Vida</div>
                            <div class="calculator-mode" id="calcMode-${character.id}">Modo: Teclado</div>
                        </div>
                        <div class="calculator-display" id="calcDisplay-${character.id}">Clique aqui e digite n√∫meros</div>
                        <div class="calculator-buttons">
                            <button class="calc-btn clear" data-action="clear">
                                <i class="fas fa-trash"></i> Limpar
                            </button>
                            <button class="calc-btn apply" data-action="apply">
                                <i class="fas fa-check"></i> Aplicar √† Vida
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Evento para visualizar imagem expandida
            const imageContainer = card.querySelector('.character-image-container');
            if (character.image) {
                imageContainer.addEventListener('click', () => {
                    showExpandedImage(character.image, character.name);
                });
            }
            
            // Evento para editar personagem
            const editBtn = card.querySelector('.character-edit-btn');
            editBtn.addEventListener('click', () => {
                openCharacterModal(character);
            });
            
            // Evento para excluir personagem
            const deleteBtn = card.querySelector('.character-delete-btn');
            deleteBtn.addEventListener('click', () => {
                deleteCharacter(character.id);
            });
            
            // Evento para upload de imagem no card
            const hiddenFileInput = document.createElement('input');
            hiddenFileInput.type = 'file';
            hiddenFileInput.accept = '.png,.jpg,.jpeg,.webp';
            hiddenFileInput.style.display = 'none';
            
            if (!character.image) {
                imageContainer.addEventListener('click', () => {
                    hiddenFileInput.click();
                });
            }
            
            hiddenFileInput.addEventListener('change', (e) => {
                if (e.target.files.length) {
                    updateCharacterImage(character.id, e.target.files[0]);
                }
            });
            
            // Configurar arrastar e soltar para o card
            imageContainer.addEventListener('dragover', (e) => {
                e.preventDefault();
                imageContainer.classList.add('drag-over');
            });
            
            imageContainer.addEventListener('dragleave', () => {
                imageContainer.classList.remove('drag-over');
            });
            
            imageContainer.addEventListener('drop', (e) => {
                e.preventDefault();
                imageContainer.classList.remove('drag-over');
                
                if (e.dataTransfer.files.length) {
                    const file = e.dataTransfer.files[0];
                    if (file.type.startsWith('image/')) {
                        updateCharacterImage(character.id, file);
                    }
                }
            });
            
            // Sistema de calculadora para o personagem
            let calcValue = "";
            const calcDisplay = card.querySelector(`#calcDisplay-${character.id}`);
            const calcMode = card.querySelector(`#calcMode-${character.id}`);
            const healthValueEl = card.querySelector(`#health-value-${character.id}`);
            
            // Ativar/desativar calculadora
            calcDisplay.addEventListener('click', () => {
                if (activeCalculator === character.id) {
                    // Desativar esta calculadora
                    activeCalculator = null;
                    calcDisplay.classList.remove('active');
                    calcMode.textContent = "Modo: Teclado";
                    calcDisplay.textContent = "Clique aqui e digite n√∫meros";
                } else {
                    // Ativar esta calculadora e desativar outras
                    activeCalculator = character.id;
                    
                    // Desativar todas as outras calculadoras
                    document.querySelectorAll('.calculator-display').forEach(display => {
                        display.classList.remove('active');
                        const otherId = display.id.replace('calcDisplay-', '');
                        if (otherId !== character.id.toString()) {
                            const otherMode = document.getElementById(`calcMode-${otherId}`);
                            if (otherMode) otherMode.textContent = "Modo: Teclado";
                            display.textContent = "Clique aqui e digite n√∫meros";
                        }
                    });
                    
                    calcDisplay.classList.add('active');
                    calcMode.textContent = "Modo: Ativo (digite n√∫meros)";
                    calcDisplay.textContent = calcValue || "0";
                    
                    // Foco global para capturar teclas
                    setTimeout(() => {
                        window.focus();
                    }, 100);
                }
            });
            
            // Adicionar eventos aos bot√µes da calculadora
            const calcBtns = card.querySelectorAll('.calc-btn');
            calcBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const action = btn.getAttribute('data-action');
                    
                    // Anima√ß√£o no bot√£o
                    btn.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        btn.style.transform = '';
                    }, 150);
                    
                    if (action === 'clear') {
                        calcValue = "";
                        calcDisplay.textContent = "0";
                        if (activeCalculator === character.id) {
                            calcDisplay.textContent = "0";
                        }
                    } else if (action === 'apply') {
                        // CORRE√á√ÉO DO BOT√ÉO APLICAR
                        const currentDisplayValue = calcDisplay.textContent;
                        
                        // Verificar se o valor √© v√°lido para c√°lculo
                        if (currentDisplayValue && 
                            currentDisplayValue !== "0" && 
                            currentDisplayValue !== "Clique aqui e digite n√∫meros" &&
                            !currentDisplayValue.includes("aplicado") &&
                            !currentDisplayValue.includes("Erro")) {
                            
                            try {
                                // Avaliar express√£o matem√°tica
                                const result = eval(currentDisplayValue);
                                if (!isNaN(result)) {
                                    const change = Math.round(result);
                                    if (change !== 0) {
                                        const actionType = change > 0 ? 'plus' : 'minus';
                                        updateHealth(character.id, actionType, Math.abs(change));
                                        
                                        // Anima√ß√£o na vida
                                        healthValueEl.classList.add('changing');
                                        setTimeout(() => {
                                            healthValueEl.classList.remove('changing');
                                        }, 500);
                                        
                                        // Mostrar feedback
                                        calcDisplay.textContent = `${change > 0 ? '+' : ''}${change} aplicado`;
                                        calcDisplay.style.color = change > 0 ? "#76ff9a" : "#ff7676";
                                        
                                        // Resetar ap√≥s 2 segundos
                                        setTimeout(() => {
                                            calcValue = "";
                                            if (activeCalculator === character.id) {
                                                calcDisplay.textContent = "0";
                                            } else {
                                                calcDisplay.textContent = "Clique aqui e digite n√∫meros";
                                            }
                                            calcDisplay.style.color = "#ffffff";
                                        }, 2000);
                                    }
                                }
                            } catch (e) {
                                calcDisplay.textContent = "Erro na express√£o";
                                calcDisplay.style.color = "#ff7676";
                                setTimeout(() => {
                                    calcValue = "";
                                    if (activeCalculator === character.id) {
                                        calcDisplay.textContent = "0";
                                    } else {
                                        calcDisplay.textContent = "Clique aqui e digite n√∫meros";
                                    }
                                    calcDisplay.style.color = "#ffffff";
                                }, 2000);
                            }
                        }
                    }
                });
            });
            
            // Adicionar eventos aos bot√µes de sa√∫de
            const healthBtns = card.querySelectorAll('.health-btn');
            healthBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const amount = parseInt(btn.getAttribute('data-amount'));
                    const isPlus = btn.classList.contains('plus');
                    
                    // Anima√ß√£o no bot√£o
                    btn.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        btn.style.transform = '';
                    }, 150);
                    
                    // Anima√ß√£o na vida
                    healthValueEl.classList.add('changing');
                    setTimeout(() => {
                        healthValueEl.classList.remove('changing');
                    }, 500);
                    
                    updateHealth(character.id, isPlus ? 'plus' : 'minus', amount);
                });
            });
            
            return card;
        }
        
        // Atualizar sa√∫de do personagem
        function updateHealth(characterId, action, amount) {
            const characterIndex = characters.findIndex(c => c.id === characterId);
            if (characterIndex === -1) return;
            
            const character = characters[characterIndex];
            
            if (action === 'plus') {
                character.health = Math.min(character.health + amount, character.maxHealth);
            } else if (action === 'minus') {
                character.health = Math.max(character.health - amount, 0);
            }
            
            // Atualizar no array
            characters[characterIndex] = character;
            
            // Salvar no localStorage
            localStorage.setItem(STORAGE_KEY, JSON.stringify(characters));
            
            // Atualizar visualiza√ß√£o
            const currentLayout = document.querySelector('.layout-btn.active').getAttribute('data-layout');
            renderCharacters(parseInt(currentLayout));
        }
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            renderCharacters(1);
            updateHistory();
            setupDragAndDrop();
            
            // Sistema de entrada por teclado
            document.addEventListener('keydown', (e) => {
                // Se estiver digitando em um input, n√£o fazer nada
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    return;
                }
                
                // Sistema de dados (s√≥ funciona se nenhuma calculadora estiver ativa)
                if (activeCalculator === null) {
                    // Atalhos para dados (teclas 1-6)
                    if (e.key >= '1' && e.key <= '6') {
                        const diceMap = ['4', '6', '8', '10', '12', '20'];
                        const index = parseInt(e.key) - 1;
                        if (index < diceMap.length) {
                            addDice(parseInt(diceMap[index]));
                            e.preventDefault();
                        }
                    } 
                    // Enter para rolar dados
                    else if (e.key === 'Enter') {
                        rollAllDice();
                        e.preventDefault();
                    }
                    // ESC para limpar dados
                    else if (e.key === 'Escape') {
                        currentRolls = [];
                        updateDiceDisplay();
                        e.preventDefault();
                    }
                    // Backspace para desfazer
                    else if (e.key === 'Backspace') {
                        if (currentRolls.length > 0) {
                            currentRolls.pop();
                            updateDiceDisplay();
                            e.preventDefault();
                        }
                    }
                }
                
                // Sistema de calculadora (s√≥ funciona se uma calculadora estiver ativa)
                if (activeCalculator !== null) {
                    const characterId = activeCalculator;
                    const calcDisplay = document.getElementById(`calcDisplay-${characterId}`);
                    
                    if (calcDisplay) {
                        // Teclas num√©ricas e operadores
                        if ((e.key >= '0' && e.key <= '9') || e.key === '+' || e.key === '-' || e.key === '*' || e.key === '/' || e.key === '.') {
                            let calcValue = calcDisplay.textContent;
                            
                            if (calcValue === "0" || calcValue.includes("aplicado") || calcValue.includes("Erro") || calcValue.includes("Clique")) {
                                calcValue = e.key;
                            } else {
                                // Verificar se o √∫ltimo caractere j√° √© um operador
                                const lastChar = calcValue.slice(-1);
                                if ((e.key === '+' || e.key === '-' || e.key === '*' || e.key === '/') && 
                                    (lastChar === '+' || lastChar === '-' || lastChar === '*' || lastChar === '/')) {
                                    // Substituir o operador anterior
                                    calcValue = calcValue.slice(0, -1) + e.key;
                                } else {
                                    calcValue += e.key;
                                }
                            }
                            
                            // Limitar tamanho
                            if (calcValue.length > 20) {
                                calcValue = calcValue.slice(0, 20);
                            }
                            
                            calcDisplay.textContent = calcValue;
                            e.preventDefault();
                        }
                        // Backspace para apagar
                        else if (e.key === 'Backspace') {
                            let calcValue = calcDisplay.textContent;
                            if (calcValue.length > 1 && !calcValue.includes("aplicado") && !calcValue.includes("Erro") && !calcValue.includes("Clique")) {
                                calcValue = calcValue.slice(0, -1);
                                calcDisplay.textContent = calcValue || "0";
                            } else {
                                calcDisplay.textContent = "0";
                            }
                            e.preventDefault();
                        }
                        // Enter para aplicar
                        else if (e.key === 'Enter') {
                            const calcValue = calcDisplay.textContent;
                            if (calcValue && calcValue !== "0" && !calcValue.includes("aplicado") && !calcValue.includes("Erro") && !calcValue.includes("Clique")) {
                                try {
                                    const result = eval(calcValue);
                                    if (!isNaN(result)) {
                                        const change = Math.round(result);
                                        if (change !== 0) {
                                            const actionType = change > 0 ? 'plus' : 'minus';
                                            updateHealth(characterId, actionType, Math.abs(change));
                                            
                                            // Mostrar feedback
                                            calcDisplay.textContent = `${change > 0 ? '+' : ''}${change} aplicado`;
                                            calcDisplay.style.color = change > 0 ? "#76ff9a" : "#ff7676";
                                            
                                            // Resetar ap√≥s 2 segundos
                                            setTimeout(() => {
                                                calcDisplay.textContent = "0";
                                                calcDisplay.style.color = "#ffffff";
                                            }, 2000);
                                        }
                                    }
                                } catch (err) {
                                    calcDisplay.textContent = "Erro na express√£o";
                                    calcDisplay.style.color = "#ff7676";
                                    setTimeout(() => {
                                        calcDisplay.textContent = "0";
                                        calcDisplay.style.color = "#ffffff";
                                    }, 2000);
                                }
                            }
                            e.preventDefault();
                        }
                        // ESC para desativar calculadora
                        else if (e.key === 'Escape') {
                            activeCalculator = null;
                            calcDisplay.classList.remove('active');
                            calcDisplay.textContent = "Clique aqui e digite n√∫meros";
                            const calcMode = document.getElementById(`calcMode-${characterId}`);
                            if (calcMode) calcMode.textContent = "Modo: Teclado";
                            e.preventDefault();
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>